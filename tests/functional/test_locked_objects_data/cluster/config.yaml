# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
- type: service
  name: dummy
  version: 1.0.10

  components:
    dummy:
      actions: &actions
        lock:
          type: job
          script_type: ansible
          script: ansible/lock.yaml
          config:
            duration:
              default: 5
              type: integer
              required: false
          states:
            available: any
            on_success: created
            on_fail: failed
        dummy:
          type: job
          script: ansible/dummy.yaml
          script_type: ansible
          states:
            available: any
    second:
      actions: *actions

  actions: *actions

- type: service
  name: second
  version: 1.0.10
  components:
    dummy:
      actions: *actions
  actions:
    expand_success:
      type: job
      script: ansible/dummy.yaml
      script_type: ansible
      hc_acl:
        - service: second
          component: dummy
          action: add
      states:
        available: any
    expand_failed:
      type: job
      script: ansible/failed.yaml
      script_type: ansible
      hc_acl:
        - service: second
          component: dummy
          action: add
      states:
        available: any
    shrink_success:
      type: job
      script: ansible/dummy.yaml
      script_type: ansible
      hc_acl:
        - service: second
          component: dummy
          action: remove
      states:
        available: any
    shrink_failed:
      type: job
      script: ansible/failed.yaml
      script_type: ansible
      hc_acl:
        - service: second
          component: dummy
          action: remove
      states:
        available: any

- type: cluster
  name: locking
  version: 1.0
  actions:
    <<: *actions
    lock-terminate:
      type: job
      script: ansible/lock-terminate.yaml
      script_type: ansible
      states:
        available: any
        on_success: terminated
        on_fail: terminate_failed
