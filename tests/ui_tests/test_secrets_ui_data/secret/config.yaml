# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- type: cluster
  version: 15
  name: secret_config
  display_name: secret_config
  config: &config
    - name: string
      type: string
      default: somestring
      required: false
    - name: secretmap
      type: secretmap
      required: false
    - name: password
      type: password
      required: false
    - name: secrettext
      type: secrettext
      required: false
    - name: secretfile
      type: secretfile
      required: false
    - name: group
      type: group
      subs:
        - name: secretmap
          type: secretmap
          read_only: any
          default: {"default_group_key": "default_secret_value"}
          group_customization: false
        - name: password
          type: password
          read_only: any
          default: "default_password"
          group_customization: false
        - name: secrettext
          type: secrettext
          read_only: any
          default: "default secret text value"
          group_customization: false
        - name: secretfile
          type: secretfile
          read_only: any
          default: ./secretfile
          group_customization: false
  actions:
    use_secretfile:
      type: job
      script: ./use_secretfile.yaml
      script_type: ansible
      states:
        available: any
    check_after_1: &action_1
      type: job
      script_type: ansible
      script: ./check_after_1.yaml
      states:
        available: any
      params:
        ansible_tags: cluster_after_1
    check_after_2: &action_2
      type: job
      script_type: ansible
      script: ./check_after_2.yaml
      states:
        available: any
      params:
        ansible_tags: cluster_after_2

- type: service
  name: test_service
  description: test_service
  version: '1.2'
  config: *config
  actions:
    check_after_1:
      <<: *action_1
      params:
        ansible_tags: service_after_1
    check_after_2:
      <<: *action_2
      params:
        ansible_tags: service_after_2


  components:
    first_component:
      config: *config
      actions:
        check_after_1:
          <<: *action_1
          params:
            ansible_tags: component_after_1
        check_after_2:
          <<: *action_2
          params:
            ansible_tags: component_after_2
